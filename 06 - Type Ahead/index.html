<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Type Ahead ðŸ‘€</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <form class="search-form">
    <input type="text" class="search" placeholder="City or Region">
    <ul class="suggestions">
      <li>Filter for a city</li>
      <li>or a region</li>
    </ul>
  </form>
<script>
    const endpoint = 'https://gist.githubusercontent.com/Neil188/ebfdd373e5ee99bc63ef3be9f5017f81/raw/3dc0cfe30dc9f0aec0b5b5affe07b8bc11107f72/UKCities.txt';

    const cities = [];

    // fetch data
    fetch(endpoint)
        .then( blob => blob.json())
        .then( data => cities.push(...data));

    // search for string anywhere within object
    const findMatches = (wordToMatch, cities) => {
        const regex = new RegExp(wordToMatch,"gi");
        const match = place => {
            let found = false;
            // match any property of object
            Object.getOwnPropertyNames(place)
                          .forEach(x => place[x].match(regex) ? found=true : null)
            return found;
        }
        return cities.filter( match );
      };

    const numWithCommas = x =>
        x.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");

    const dispMatches = e => {
        const search = e.target.value;
        const matchArray = findMatches(search,cities);
        const regex = new RegExp(search,"gi");
        const highlight = `<span class="hl">${search}</span>`;
        const html = matchArray.map( place => {
            // highlight search term in city or region
            // note population not highlighted as it breaks numwithcommas 
            const cityName = place.city.replace(regex, highlight);
            const regionName = place.region.replace(regex, highlight);
            return `
                <li>
                    <span class="name">${cityName}, ${regionName}</span>
                    <span class="population">${numWithCommas(place.population)}</span>
                </li>
                `
        }).join('');
        suggestions.innerHTML = html;
    }

    const searchInput = document.querySelector(".search");
    const suggestions = document.querySelector(".suggestions");

    // whenever search input changes rebuild list
    // note the change event only fires when you leave the input
    searchInput.addEventListener("change", dispMatches);
    searchInput.addEventListener("keyup", dispMatches);
</script>
  </body>
</html>
